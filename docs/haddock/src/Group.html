<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
A module for creating collections of homogenous shape types, optimizing
shapes (combining paths when possible or removing duplicates), applying
transformations to all of them, and rendering them as SVG elements.
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Group</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM_</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">groupBy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sort</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hPutStrLn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">stderr</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text.Blaze.Svg11</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Svg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">g</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text.Printf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">printf</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="ApproxEq.html"><span class="hs-identifier">ApproxEq</span></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="Layer.html"><span class="hs-identifier">Layer</span></a><span> </span><span class="hs-special">(</span><a href="Layer.html#Layer"><span class="hs-identifier hs-type">Layer</span></a><span class="hs-special">,</span><span> </span><a href="Layer.html#mkLayer"><span class="hs-identifier hs-var">mkLayer</span></a><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Shape.html"><span class="hs-identifier">Shape</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Style.html"><span class="hs-identifier">Style</span></a><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-comment">-- | A type reprresenting a named group of some type of shape.</span><span>
</span><a name="line-21"></a><span class="hs-keyword">newtype</span><span> </span><a name="Group"><a href="Group.html#Group"><span class="hs-identifier">Group</span></a></a><span> </span><a name="local-6989586621679047168"><a href="#local-6989586621679047168"><span class="hs-identifier">shape</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Group"><a href="Group.html#Group"><span class="hs-identifier">Group</span></a></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679047168"><span class="hs-identifier hs-type">shape</span></a><span class="hs-special">]</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679047364"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047364"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-24"></a><span>    </span><a name="local-8214565720323790326"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-comment">-- | Groups can be combined.</span><span>
</span><a name="line-27"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679047361"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#SvgShape"><span class="hs-identifier hs-type">S.SvgShape</span></a><span> </span><a href="#local-6989586621679047361"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#Transformable"><span class="hs-identifier hs-type">S.Transformable</span></a><span> </span><a href="#local-6989586621679047361"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#Mergable"><span class="hs-identifier hs-type">S.Mergable</span></a><span> </span><a href="#local-6989586621679047361"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047361"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-28"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><a name="local-6989586621679047363"><a href="#local-6989586621679047363"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">as</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679047363"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">-- | There exists an identity element for any group.</span><span>
</span><a name="line-31"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679047360"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#SvgShape"><span class="hs-identifier hs-type">S.SvgShape</span></a><span> </span><a href="#local-6989586621679047360"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#Transformable"><span class="hs-identifier hs-type">S.Transformable</span></a><span> </span><a href="#local-6989586621679047360"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#Mergable"><span class="hs-identifier hs-type">S.Mergable</span></a><span> </span><a href="#local-6989586621679047360"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047360"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-32"></a><span>    </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-comment">-- | A group can be mapped over just like any other container.</span><span>
</span><a name="line-35"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-36"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-6989586621679047358"><a href="#local-6989586621679047358"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679047358"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-39"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621679047170"><a href="#local-6989586621679047170"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679047170"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><a name="local-6989586621679047171"><a href="#local-6989586621679047171"><span class="hs-identifier">fn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679047356"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679047357"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679047356"><a href="#local-6989586621679047356"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679047357"><a href="#local-6989586621679047357"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679047171"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | Groups can be transformed in the same way single shapes can.</span><span>
</span><a name="line-44"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Shape.html#Transformable"><span class="hs-identifier hs-type">S.Transformable</span></a><span> </span><a href="#local-6989586621679047169"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Shape.html#Transformable"><span class="hs-identifier hs-type">S.Transformable</span></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047169"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-45"></a><span>    </span><a name="local-8214565720323815873"><a href="Shape.html#translate"><span class="hs-identifier">translate</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Shape.html#translate"><span class="hs-identifier hs-var">S.translate</span></a><span>
</span><a name="line-46"></a><span>    </span><a name="local-8214565720323815874"><a href="Shape.html#translateP"><span class="hs-identifier">translateP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Shape.html#translateP"><span class="hs-identifier hs-var">S.translateP</span></a><span>
</span><a name="line-47"></a><span>    </span><a name="local-8214565720323815875"><a href="Shape.html#rotate"><span class="hs-identifier">rotate</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Shape.html#rotate"><span class="hs-identifier hs-var">S.rotate</span></a><span>
</span><a name="line-48"></a><span>    </span><a name="local-8214565720323815876"><a href="Shape.html#mirror"><span class="hs-identifier">mirror</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Shape.html#mirror"><span class="hs-identifier hs-var">S.mirror</span></a><span>
</span><a name="line-49"></a><span>    </span><a name="local-8214565720323815877"><a href="Shape.html#offset"><span class="hs-identifier">offset</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Shape.html#offset"><span class="hs-identifier hs-var">S.offset</span></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- | Convert a group to a layer.</span><span>
</span><a name="line-52"></a><span class="hs-identifier">toLayer</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679047373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#SvgShape"><span class="hs-identifier hs-type">S.SvgShape</span></a><span> </span><a href="#local-6989586621679047373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#Transformable"><span class="hs-identifier hs-type">S.Transformable</span></a><span> </span><a href="#local-6989586621679047373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047373"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Layer.html#Layer"><span class="hs-identifier hs-type">Layer</span></a><span>
</span><a name="line-53"></a><a name="toLayer"><a href="Group.html#toLayer"><span class="hs-identifier">toLayer</span></a></a><span> </span><a name="local-6989586621679047374"><a href="#local-6989586621679047374"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><a name="local-6989586621679047375"><a href="#local-6989586621679047375"><span class="hs-identifier">shapes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Layer.html#mkLayer"><span class="hs-identifier hs-var">mkLayer</span></a><span> </span><a href="#local-6989586621679047374"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679047375"><span class="hs-identifier hs-var">shapes</span></a><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">-- | Number of shapes in the group.</span><span>
</span><a name="line-56"></a><span class="hs-identifier">size</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047372"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-57"></a><a name="size"><a href="Group.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-comment">-- | Remove any duplicate shapes from this group</span><span>
</span><a name="line-60"></a><span class="hs-identifier">deduplicate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679047371"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">,</span><span> </span><a href="ApproxEq.html#ApproxEq"><span class="hs-identifier hs-type">ApproxEq</span></a><span> </span><a href="#local-6989586621679047371"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047371"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047371"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-61"></a><a name="deduplicate"><a href="Group.html#deduplicate"><span class="hs-identifier">deduplicate</span></a></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><a name="local-6989586621679047377"><a href="#local-6989586621679047377"><span class="hs-identifier">grp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047378"><span class="hs-identifier hs-var">nub</span></a><span> </span><a href="#local-6989586621679047377"><span class="hs-identifier hs-var">grp</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679047378"><a href="#local-6989586621679047378"><span class="hs-identifier">nub</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span> </span><span class="hs-special">(</span><a href="ApproxEq.html#%3D~"><span class="hs-operator hs-var">=~</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sort</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-identifier">transformAndAppend</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679047370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#SvgShape"><span class="hs-identifier hs-type">S.SvgShape</span></a><span> </span><a href="#local-6989586621679047370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#Transformable"><span class="hs-identifier hs-type">S.Transformable</span></a><span> </span><a href="#local-6989586621679047370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Shape.html#Mergable"><span class="hs-identifier hs-type">S.Mergable</span></a><span> </span><a href="#local-6989586621679047370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047370"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679047370"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047370"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047370"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-66"></a><a name="transformAndAppend"><a href="Group.html#transformAndAppend"><span class="hs-identifier">transformAndAppend</span></a></a><span> </span><a name="local-6989586621679047533"><a href="#local-6989586621679047533"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><a name="local-6989586621679047534"><a href="#local-6989586621679047534"><span class="hs-identifier">grp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047534"><span class="hs-identifier hs-var">grp</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679047535"><span class="hs-identifier hs-var">newShapes</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679047535"><a href="#local-6989586621679047535"><span class="hs-identifier">newShapes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679047533"><span class="hs-identifier hs-var">fn</span></a><span> </span><a href="#local-6989586621679047534"><span class="hs-identifier hs-var">grp</span></a><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- | Produce a new group where all shapes that can be merged have been, plus all shapes that couldn't be.</span><span>
</span><a name="line-70"></a><span class="hs-identifier">optimizeGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Shape.html#Mergable"><span class="hs-identifier hs-type">S.Mergable</span></a><span> </span><a href="#local-6989586621679047369"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047369"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047369"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-71"></a><a name="optimizeGroup"><a href="Group.html#optimizeGroup"><span class="hs-identifier">optimizeGroup</span></a></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><a name="local-6989586621679047536"><a href="#local-6989586621679047536"><span class="hs-identifier">grp</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679047537"><a href="#local-6989586621679047537"><span class="hs-identifier">epsilon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><span class="hs-special">(</span><a href="Shape.html#optimize"><span class="hs-identifier hs-var">S.optimize</span></a><span> </span><a href="#local-6989586621679047536"><span class="hs-identifier hs-var">grp</span></a><span> </span><a href="#local-6989586621679047537"><span class="hs-identifier hs-var">epsilon</span></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | Produce a new group where all shapes that can be merged have been, </span><span>
</span><a name="line-74"></a><span class="hs-comment">-- plus all shapes that couldn't be, logging the result at the end.</span><span>
</span><a name="line-75"></a><span class="hs-identifier">optimizeGroupAndLog</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Shape.html#Mergable"><span class="hs-identifier hs-type">S.Mergable</span></a><span> </span><a href="#local-6989586621679047368"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047368"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047368"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><a name="optimizeGroupAndLog"><a href="Group.html#optimizeGroupAndLog"><span class="hs-identifier">optimizeGroupAndLog</span></a></a><span> </span><a name="local-6989586621679047538"><a href="#local-6989586621679047538"><span class="hs-identifier">group</span></a></a><span> </span><a name="local-6989586621679047539"><a href="#local-6989586621679047539"><span class="hs-identifier">epsilon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hPutStrLn</span><span> </span><span class="hs-identifier hs-var">stderr</span><span> </span><a href="#local-6989586621679047543"><span class="hs-identifier hs-var">mssg</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679047541"><span class="hs-identifier hs-var">optGrp</span></a><span>
</span><a name="line-77"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-78"></a><span>    </span><a name="local-6989586621679047540"><a href="#local-6989586621679047540"><span class="hs-identifier">_start</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679047538"><span class="hs-identifier hs-var">group</span></a><span>
</span><a name="line-79"></a><span>    </span><a name="local-6989586621679047541"><a href="#local-6989586621679047541"><span class="hs-identifier">optGrp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#optimizeGroup"><span class="hs-identifier hs-var">optimizeGroup</span></a><span> </span><a href="#local-6989586621679047538"><span class="hs-identifier hs-var">group</span></a><span> </span><a href="#local-6989586621679047539"><span class="hs-identifier hs-var">epsilon</span></a><span>
</span><a name="line-80"></a><span>    </span><a name="local-6989586621679047542"><a href="#local-6989586621679047542"><span class="hs-identifier">_end</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Group.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679047541"><span class="hs-identifier hs-var">optGrp</span></a><span>
</span><a name="line-81"></a><span>    </span><a name="local-6989586621679047543"><a href="#local-6989586621679047543"><span class="hs-identifier">mssg</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">printf</span><span> </span><span class="hs-string">&quot;Optimized group: %d shapes to %d&quot;</span><span> </span><a href="#local-6989586621679047540"><span class="hs-identifier hs-var">_start</span></a><span> </span><a href="#local-6989586621679047542"><span class="hs-identifier hs-var">_end</span></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">-- | Wrap a group of shapes into an SVG &lt;g&gt; element, including a comment</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- with the name of the group.</span><span>
</span><a name="line-85"></a><span class="hs-identifier">toSvgN</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Shape.html#SvgShape"><span class="hs-identifier hs-type">S.SvgShape</span></a><span> </span><a href="#local-6989586621679047367"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047367"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Svg</span><span>
</span><a name="line-86"></a><a name="toSvgN"><a href="Group.html#toSvgN"><span class="hs-identifier">toSvgN</span></a></a><span> </span><span class="hs-special">(</span><a href="Group.html#Group"><span class="hs-identifier hs-var">Group</span></a><span> </span><a name="local-6989586621679047791"><a href="#local-6989586621679047791"><span class="hs-identifier">grp</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">g</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="Shape.html#toSvg"><span class="hs-identifier hs-var">S.toSvg</span></a><span> </span><a href="#local-6989586621679047791"><span class="hs-identifier hs-var">grp</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-comment">-- | Wrap a group of shapes into an SVG &lt;g&gt; element, including a comment</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- with the name of the group. Apply the given styles to the group.</span><span>
</span><a name="line-91"></a><span class="hs-identifier">toSvgWithStyle</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Shape.html#SvgShape"><span class="hs-identifier hs-type">S.SvgShape</span></a><span> </span><a href="#local-6989586621679047366"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Group.html#Group"><span class="hs-identifier hs-type">Group</span></a><span> </span><a href="#local-6989586621679047366"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Style.html#StyleAttrs"><span class="hs-identifier hs-type">StyleAttrs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Svg</span><span>
</span><a name="line-92"></a><a name="toSvgWithStyle"><a href="Group.html#toSvgWithStyle"><span class="hs-identifier">toSvgWithStyle</span></a></a><span> </span><a name="local-6989586621679047792"><a href="#local-6989586621679047792"><span class="hs-identifier">grp</span></a></a><span> </span><a name="local-6989586621679047793"><a href="#local-6989586621679047793"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Style.html#applyStyle"><span class="hs-identifier hs-var">applyStyle</span></a><span> </span><a href="#local-6989586621679047793"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Group.html#toSvgN"><span class="hs-identifier hs-var">toSvgN</span></a><span> </span><a href="#local-6989586621679047792"><span class="hs-identifier hs-var">grp</span></a><span>
</span><a name="line-93"></a></pre></body></html>